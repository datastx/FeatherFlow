version: 1
models:
  model.marts.finance.monthly_trends.monthly_trends:
    name: monthly_trends
    path: marts/finance/monthly_trends/monthly_trends.sql
    description: Monthly transaction trends and patterns
    materialized: table
    database: analytics
    schema: marts_finance
    object_name: monthly_trends
    tags:
    - mart
    - finance
    - monthly
    - trends
    columns:
    - name: mom_amount_change_pct
      description: Month-over-month percentage change in transaction amount
      data_type: decimal
    - name: total_inflows
      description: Total amount of incoming transactions
      data_type: decimal
    - name: net_flow
      description: Net cash flow (inflows - outflows)
      data_type: decimal
    - name: total_outflows
      description: Total amount of outgoing transactions
      data_type: decimal
    - name: unique_merchants
      description: Number of unique merchants transacting in the month
      data_type: integer
    - name: yoy_transaction_change_pct
      description: Year-over-year percentage change in transaction count
      data_type: decimal
    - name: year
      description: Year of analysis
      data_type: integer
    - name: month_end_date
      description: Last day of the month
      data_type: date
    - name: yoy_amount_change_pct
      description: Year-over-year percentage change in transaction amount
      data_type: decimal
    - name: total_transactions
      description: Total number of transactions in the month
      data_type: integer
    - name: total_transaction_amount
      description: Total amount of all transactions in the month
      data_type: decimal
    - name: avg_transaction_amount
      description: Average transaction amount in the month
      data_type: decimal
    - name: top_spending_amount
      description: Amount spent in the top spending category
      data_type: decimal
    - name: avg_daily_transactions
      description: Average number of transactions per day in the month
      data_type: decimal
    - name: top_spending_category
      description: Category with the highest spending in the month
      data_type: string
    - name: month
      description: Month of analysis (1-12)
      data_type: integer
    - name: unique_customers
      description: Number of unique customers transacting in the month
      data_type: integer
    - name: month_start_date
      description: First day of the month
      data_type: date
    - name: mom_transaction_change_pct
      description: Month-over-month percentage change in transaction count
      data_type: decimal
    depends_on:
    - model.staging.stg_transactions.stg_transactions
    - model.staging.stg_merchants.stg_merchants
    referenced_by: []
    external_sources: []
    depth: 1
  model.staging.stg_merchants.stg_merchants:
    name: stg_merchants
    path: staging/stg_merchants/stg_merchants.sql
    description: Staging model for merchants table
    materialized: view
    database: analytics
    schema: staging
    object_name: stg_merchants
    tags:
    - staging
    - merchants
    columns:
    - name: name
      description: Name of the merchant
      data_type: string
    - name: location
      description: Geographic location of the merchant
      data_type: string
    - name: merchant_id
      description: Unique identifier for the merchant
      data_type: integer
    - name: popularity_score
      description: Score indicating the merchant's popularity
      data_type: float
    - name: category
      description: Business category of the merchant
      data_type: string
    - name: is_online
      description: Flag indicating if the merchant is an online-only business
      data_type: boolean
    depends_on: []
    referenced_by:
    - model.marts.core.merchant_summary.merchant_summary
    - model.marts.finance.spending_categories.spending_categories
    - model.marts.finance.recurring_analysis.recurring_analysis
    - model.marts.finance.daily_trends.daily_trends
    - model.marts.finance.monthly_trends.monthly_trends
    external_sources:
    - raw_data.merchants
    depth: 0
  model.marts.finance.daily_trends.daily_trends:
    name: daily_trends
    path: marts/finance/daily_trends/daily_trends.sql
    description: Daily transaction trends and patterns
    materialized: table
    database: analytics
    schema: marts_finance
    object_name: daily_trends
    tags:
    - mart
    - finance
    - daily
    - trends
    columns:
    - name: top_spending_category
      description: Category with the highest spending on this day
      data_type: string
    - name: evening_transactions
      description: Number of transactions in the evening (6pm-12am)
      data_type: integer
    - name: night_transactions
      description: Number of transactions at night (12am-6am)
      data_type: integer
    - name: unique_customers
      description: Number of unique customers transacting on this day
      data_type: integer
    - name: transaction_date
      description: Date of transactions
      data_type: date
    - name: avg_transaction_amount
      description: Average transaction amount on this day
      data_type: decimal
    - name: unique_merchants
      description: Number of unique merchants transacting on this day
      data_type: integer
    - name: is_weekend
      description: Flag indicating if the day is a weekend
      data_type: boolean
    - name: total_transactions
      description: Total number of transactions on this day
      data_type: integer
    - name: day_of_week
      description: Day of week (1-7, Monday to Sunday)
      data_type: integer
    - name: total_amount
      description: Total transaction amount on this day
      data_type: decimal
    - name: top_spending_amount
      description: Amount spent in the top spending category
      data_type: decimal
    - name: morning_transactions
      description: Number of transactions in the morning (6am-12pm)
      data_type: integer
    - name: afternoon_transactions
      description: Number of transactions in the afternoon (12pm-6pm)
      data_type: integer
    depends_on:
    - model.staging.stg_transactions.stg_transactions
    - model.staging.stg_merchants.stg_merchants
    referenced_by: []
    external_sources: []
    depth: 1
  model.staging.stg_accounts.stg_accounts:
    name: stg_accounts
    path: staging/stg_accounts/stg_accounts.sql
    description: Staging model for accounts table
    materialized: view
    database: analytics
    schema: staging
    object_name: stg_accounts
    tags:
    - staging
    - accounts
    columns:
    - name: open_date
      description: Date when the account was opened
      data_type: date
    - name: account_type
      description: Type of the account (checking, savings, etc.)
      data_type: string
    - name: current_balance
      description: Current balance of the account
      data_type: decimal
    - name: account_id
      description: Unique identifier for the account
      data_type: integer
    - name: status
      description: Current status of the account (active, closed, suspended)
      data_type: string
    - name: initial_balance
      description: Initial balance of the account when opened
      data_type: decimal
    - name: customer_id
      description: Foreign key to the customers table
      data_type: integer
    - name: currency
      description: Currency of the account
      data_type: string
    depends_on: []
    referenced_by:
    - model.marts.finance.recurring_analysis.recurring_analysis
    - model.marts.core.customer_summary.customer_summary
    external_sources:
    - raw_data.accounts
    depth: 0
  model.staging.stg_transactions.stg_transactions:
    name: stg_transactions
    path: staging/stg_transactions/stg_transactions.sql
    description: Staging model for transactions table
    materialized: view
    database: analytics
    schema: staging
    object_name: stg_transactions
    tags:
    - staging
    - transactions
    columns:
    - name: card_id
      description: Foreign key to the credit cards table
      data_type: integer
    - name: time_of_day
      description: Time of day category (morning, afternoon, evening, night)
      data_type: string
    - name: season
      description: Season when the transaction occurred (Winter, Spring, Summer, Fall)
      data_type: string
    - name: transaction_type
      description: Type of transaction (payment, deposit, withdrawal, etc.)
      data_type: string
    - name: amount
      description: Transaction amount (negative for outgoing, positive for incoming)
      data_type: decimal
    - name: year
      description: Year when the transaction occurred
      data_type: integer
    - name: transaction_id
      description: Unique identifier for the transaction
      data_type: integer
    - name: month
      description: Month (1-12) when the transaction occurred
      data_type: integer
    - name: is_recurring
      description: Flag indicating if the transaction is recurring
      data_type: boolean
    - name: description
      description: Description of the transaction
      data_type: string
    - name: day_of_week
      description: Day of the week (1-7) when the transaction occurred
      data_type: integer
    - name: transaction_datetime
      description: Date and time when the transaction occurred
      data_type: timestamp
    - name: category
      description: Category of the transaction
      data_type: string
    - name: account_id
      description: Foreign key to the accounts table
      data_type: integer
    - name: status
      description: Status of the transaction (cleared, pending, cancelled)
      data_type: string
    - name: day_of_month
      description: Day of the month (1-31) when the transaction occurred
      data_type: integer
    - name: merchant_id
      description: Foreign key to the merchants table
      data_type: integer
    depends_on: []
    referenced_by:
    - model.marts.finance.spending_categories.spending_categories
    - model.marts.finance.monthly_trends.monthly_trends
    - model.marts.core.merchant_summary.merchant_summary
    - model.marts.finance.daily_trends.daily_trends
    - model.marts.finance.recurring_analysis.recurring_analysis
    - model.marts.core.customer_summary.customer_summary
    external_sources:
    - raw_data.transactions
    depth: 0
  model.marts.core.merchant_summary.merchant_summary:
    name: merchant_summary
    path: marts/core/merchant_summary/merchant_summary.sql
    description: Aggregated merchant metrics and summary information
    materialized: table
    database: analytics
    schema: marts_core
    object_name: merchant_summary
    tags:
    - mart
    - core
    - merchant
    columns:
    - name: peak_transaction_month
      description: Month with the highest transaction volume
      data_type: string
    - name: first_transaction_date
      description: Date of the merchant's first transaction
      data_type: date
    - name: customer_count
      description: Number of unique customers who have transacted with this merchant
      data_type: integer
    - name: peak_transaction_day
      description: Day of the week with the highest transaction volume
      data_type: string
    - name: merchant_category
      description: Business category of the merchant
      data_type: string
    - name: total_transactions
      description: Total number of transactions processed by the merchant
      data_type: integer
    - name: merchant_name
      description: Name of the merchant
      data_type: string
    - name: total_transaction_amount
      description: Total amount of transactions processed by the merchant
      data_type: decimal
    - name: avg_transaction_amount
      description: Average amount per transaction for the merchant
      data_type: decimal
    - name: merchant_id
      description: Unique identifier for the merchant
      data_type: integer
    - name: last_transaction_date
      description: Date of the merchant's most recent transaction
      data_type: date
    - name: transaction_growth_rate
      description: Month-over-month growth rate in transaction volume
      data_type: decimal
    depends_on:
    - model.staging.stg_transactions.stg_transactions
    - model.staging.stg_merchants.stg_merchants
    referenced_by: []
    external_sources: []
    depth: 1
  model.marts.finance.recurring_analysis.recurring_analysis:
    name: recurring_analysis
    path: marts/finance/recurring_analysis/recurring_analysis.sql
    description: Analysis of recurring transactions and subscriptions
    materialized: table
    database: analytics
    schema: marts_finance
    object_name: recurring_analysis
    tags:
    - mart
    - finance
    - recurring
    - subscriptions
    columns:
    - name: transaction_frequency
      description: Estimated frequency of recurring transactions (daily, weekly, monthly, quarterly, yearly)
      data_type: string
    - name: total_spent
      description: Total amount spent on this recurring transaction
      data_type: decimal
    - name: percentage_of_total_spending
      description: Percentage of the customer's total spending
      data_type: decimal
    - name: avg_days_between_transactions
      description: Average number of days between recurring transactions
      data_type: decimal
    - name: merchant_id
      description: Unique identifier for the merchant
      data_type: integer
    - name: merchant_name
      description: Name of the merchant
      data_type: string
    - name: merchant_category
      description: Business category of the merchant
      data_type: string
    - name: customer_id
      description: Unique identifier for the customer
      data_type: integer
    - name: first_transaction_date
      description: Date of the first recurring transaction
      data_type: date
    - name: avg_transaction_amount
      description: Average amount per recurring transaction
      data_type: decimal
    - name: last_transaction_date
      description: Date of the most recent recurring transaction
      data_type: date
    - name: transaction_count
      description: Number of recurring transactions
      data_type: integer
    - name: is_active
      description: Flag indicating if the recurring transaction is still active
      data_type: boolean
    - name: estimated_annual_cost
      description: Estimated annual cost of this recurring transaction
      data_type: decimal
    depends_on:
    - model.staging.stg_merchants.stg_merchants
    - model.staging.stg_accounts.stg_accounts
    - model.staging.stg_transactions.stg_transactions
    - model.staging.stg_customers.stg_customers
    referenced_by: []
    external_sources: []
    depth: 1
  model.marts.finance.spending_categories.spending_categories:
    name: spending_categories
    path: marts/finance/spending_categories/spending_categories.sql
    description: Analysis of spending by category over time
    materialized: table
    database: analytics
    schema: marts_finance
    object_name: spending_categories
    tags:
    - mart
    - finance
    - spending
    columns:
    - name: category_rank
      description: Rank of the category within the month by spending amount (1 is highest)
      data_type: integer
    - name: prev_year_category_spending
      description: Spending in the same category and month in the previous year
      data_type: decimal
    - name: category_spending
      description: Total amount spent in this category
      data_type: decimal
    - name: yoy_category_pct_change
      description: Year-over-year percentage change in spending for this category
      data_type: decimal
    - name: season
      description: Season of the transaction (Winter, Spring, Summer, Fall)
      data_type: string
    - name: transaction_count
      description: Number of transactions in this category
      data_type: integer
    - name: month
      description: Month of the transaction (1-12)
      data_type: integer
    - name: year
      description: Year of the transaction
      data_type: integer
    - name: month_start
      description: First day of the month as a date
      data_type: date
    - name: category_pct_of_total
      description: Percentage of total monthly spending in this category
      data_type: decimal
    - name: category
      description: Spending category
      data_type: string
    depends_on:
    - model.staging.stg_merchants.stg_merchants
    - model.staging.stg_transactions.stg_transactions
    referenced_by: []
    external_sources: []
    depth: 1
  model.staging.stg_customers.stg_customers:
    name: stg_customers
    path: staging/stg_customers/stg_customers.sql
    description: Staging model for customers table
    materialized: view
    database: analytics
    schema: staging
    object_name: stg_customers
    tags:
    - staging
    - customers
    columns:
    - name: registration_date
      description: Date when the customer registered
      data_type: date
    - name: address
      description: Physical address of the customer
      data_type: string
    - name: income_bracket
      description: Income bracket of the customer
      data_type: string
    - name: email
      description: Email address of the customer
      data_type: string
    - name: credit_score
      description: Credit score of the customer
      data_type: integer
    - name: name
      description: Full name of the customer
      data_type: string
    - name: customer_id
      description: Unique identifier for the customer
      data_type: integer
    depends_on: []
    referenced_by:
    - model.marts.finance.recurring_analysis.recurring_analysis
    - model.marts.core.customer_summary.customer_summary
    external_sources:
    - raw_data.customers
    depth: 0
  model.marts.core.customer_summary.customer_summary:
    name: customer_summary
    path: marts/core/customer_summary/customer_summary.sql
    description: Aggregated customer metrics and summary information
    materialized: table
    database: analytics
    schema: marts_core
    object_name: customer_summary
    tags:
    - mart
    - core
    - customer
    columns:
    - name: total_income_amount
      description: Total amount received by the customer (incoming transactions)
      data_type: decimal
    - name: total_accounts
      description: Total number of accounts owned by the customer
      data_type: integer
    - name: total_balance
      description: Sum of all account balances for the customer
      data_type: decimal
    - name: customer_id
      description: Unique identifier for the customer
      data_type: integer
    - name: last_transaction_date
      description: Date of the customer's most recent transaction
      data_type: date
    - name: first_transaction_date
      description: Date of the customer's first transaction
      data_type: date
    - name: full_name
      description: Full name of the customer
      data_type: string
    - name: primary_merchant_category
      description: The merchant category where the customer spends the most
      data_type: string
    - name: total_spending_amount
      description: Total amount spent by the customer (outgoing transactions)
      data_type: decimal
    - name: avg_daily_transactions
      description: Average number of daily transactions by the customer
      data_type: float
    - name: customer_segment
      description: Segmentation category based on spending behavior
      data_type: string
    depends_on:
    - model.staging.stg_accounts.stg_accounts
    - model.staging.stg_transactions.stg_transactions
    - model.staging.stg_customers.stg_customers
    referenced_by: []
    external_sources: []
    depth: 1
